<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=59770&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Raft Paper">
<title>Raft Paper</title>

<link rel='canonical' href='http://localhost:59770/p/raft-paper/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Raft Paper">
<meta property='og:description' content="Raft Paper">
<meta property='og:url' content='http://localhost:59770/p/raft-paper/'>
<meta property='og:site_name' content='GreyWind'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='MIT-6.824' /><meta property='article:published_time' content='2023-08-31T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-08-31T00:00:00&#43;00:00'/><meta property='og:image' content='http://localhost:59770/p/raft-paper/4edbcd64-afa3-4eff-8d34-2624bf875149.webp' />
<meta name="twitter:title" content="Raft Paper">
<meta name="twitter:description" content="Raft Paper"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://localhost:59770/p/raft-paper/4edbcd64-afa3-4eff-8d34-2624bf875149.webp' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_dca9491aad8d3457.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">GreyWind</a></h1>
            <h2 class="site-description">Do one thing and do it well.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/fuwx295'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg t="1740911471151" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5331" id="mx_n_1740911471153" width="24" height="24" xmlns:xlink="http://www.w3.org/1999/xlink">
<path d="M679.834025 1019.751037c-25.493776 0-42.489627-16.995851-42.489627-42.489626v-165.709544c0-33.991701-8.497925-59.485477-29.742738-80.73029-12.746888-12.746888-16.995851-29.742739-8.497926-42.489627 8.497925-12.746888 21.244813-25.493776 33.991702-29.742738 123.219917-12.746888 237.941909-55.236515 237.941908-254.93776s-16.995851-93.477178-50.987551-131.717842c-12.746888-12.746888-12.746888-29.742739-8.497926-42.489627 12.746888-33.991701 12.746888-67.983402 4.248963-101.975103-21.244813 4.248963-55.236515 16.995851-110.473029 55.236514-8.497925 8.497925-21.244813 8.497925-33.991701 4.248963-89.228216-25.493776-186.954357-25.493776-276.182573 0-12.746888 0-25.493776 0-33.991701-4.248963C305.925311 144.46473 267.684647 131.717842 250.688797 127.46888c-8.497925 33.991701-4.248963 67.983402 4.248962 101.975103 4.248963 16.995851 0 33.991701-8.497925 42.489627-33.991701 33.991701-50.987552 80.73029-50.987552 131.717842 0 199.701245 114.721992 242.190871 237.941909 254.93776 16.995851 0 29.742739 12.746888 33.991701 29.742738 4.248963 16.995851 0 33.991701-8.497925 42.489627-21.244813 21.244813-29.742739 46.738589-29.742739 76.481328v165.709543c0 25.493776-16.995851 42.489627-42.489626 42.489627s-42.489627-16.995851-42.489627-42.489627v-72.232365c-127.46888 21.244813-182.705394-50.987552-220.946058-97.726141-16.995851-21.244813-29.742739-38.240664-46.738589-42.489627-21.244813-4.248963-38.240664-29.742739-29.742739-50.987552 4.248963-21.244813 29.742739-38.240664 50.987552-29.742738 42.489627 12.746888 67.983402 42.489627 93.477179 72.232365 33.991701 46.738589 63.73444 80.73029 152.962655 63.73444 0-29.742739 0-59.485477 12.746888-80.730291-118.970954-25.493776-246.439834-101.975104-246.439834-327.170124 0-63.73444 21.244813-123.219917 59.485477-169.958506-12.746888-55.236515-8.497925-114.721992 12.746888-165.709544 4.248963-12.746888 12.746888-21.244813 25.493776-25.493776 16.995851-4.248963 72.232365-12.746888 186.954357 59.485477 93.477178-21.244813 191.20332-21.244813 280.431535 0 110.473029-72.232365 169.958506-63.73444 186.954357-59.485477 12.746888 0 21.244813 12.746888 25.493776 25.493776 21.244813 55.236515 25.493776 110.473029 12.746888 165.709544 38.240664 46.738589 59.485477 106.224066 59.485477 169.958506 0 242.190871-144.46473 305.925311-246.439834 331.419087 8.497925 25.493776 12.746888 55.236515 12.746888 80.730291v161.46058c0 25.493776-16.995851 42.489627-42.489626 42.489627L679.834025 1019.751037z" fill="currentColor" p-id="5332"></path>
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com/GreyWind2077'
                        target="_blank"
                        title="X"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg t="1740911581981" class="icon" viewBox="0 0 1088 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8935" xmlns:xlink="http://www.w3.org/1999/xlink" width="25.5" height="24">
<path d="M647.488 433.344L1052.544 0h-96L604.864 376.32 323.968 0H0l424.768 568.96L0 1023.552h96l371.392-397.44 296.64 397.44H1088l-440.512-590.08zM516.032 574.08l-43.008-56.64-342.4-450.88h147.392l276.352 363.904 43.008 56.64L956.608 960h-147.456l-293.12-385.92z" fill="currentColor" p-id="8936"></path>
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:f2928560492@gmail.com'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1740916044811" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11060" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24"><path d="M815.25 80.23h-606.9c-111.86 0-202.87 91-202.87 202.88v470C5.48 865 96.5 956 208.35 956h606.89c111.87 0 202.88-91 202.88-202.88v-470c0.01-111.89-91-202.89-202.87-202.89zM706.43 449.74l213.14-229.11c11.03 18.34 17.76 39.56 17.76 62.49v379.13l-230.9-212.51z m108.82-288.71c14.84 0 28.89 3.05 42.06 7.92L511.79 540.34 166.3 168.95c13.17-4.87 27.22-7.92 42.05-7.92h606.9z m-711.21 59.6l213.13 229.11L86.28 662.25V283.12c0-22.92 6.73-44.15 17.76-62.49zM815.25 875.2h-606.9c-61.39 0-111.83-45.69-120.33-104.78l284.16-261.54 139.6 150.07L651.4 508.88l284.18 261.54c-8.5 59.09-58.95 104.78-120.33 104.78z" fill="currentColor" p-id="11061"></path></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#replicated-state-machines">Replicated state machines</a></li>
    <li><a href="#the-raft-consensus-algorithm">The Raft consensus algorithm</a>
      <ol>
        <li><a href="#raft-basics">Raft basics</a></li>
        <li><a href="#leader-election">Leader election</a></li>
        <li><a href="#log-replication">Log replication</a></li>
        <li><a href="#safety">Safety</a>
          <ol>
            <li><a href="#election-restriction">Election restriction</a></li>
            <li><a href="#commiting-entries-from-previous-terms">Commiting entries from previous terms</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#cluster-membership-changes">Cluster membership changes</a></li>
    <li><a href="#log-compaction">Log compaction</a></li>
    <li><a href="#raft-implementation">Raft Implementation</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/raft-paper/">
                <img src="/p/raft-paper/4edbcd64-afa3-4eff-8d34-2624bf875149_hu_cb13a6e221afa576.webp"
                        srcset="/p/raft-paper/4edbcd64-afa3-4eff-8d34-2624bf875149_hu_cb13a6e221afa576.webp 800w, /p/raft-paper/4edbcd64-afa3-4eff-8d34-2624bf875149_hu_fe8c1d6eeb390e4b.webp 1600w"
                        width="800" 
                        height="800" 
                        loading="lazy"
                        alt="Featured image of post Raft Paper" />
                
            </a>
        </div>
    

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/raft-paper/">Raft Paper</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Raft Paper
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 31, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    14 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="introduction">Introduction
</h2><p>Raft is a consensus algorithm for managing a replicated log. Consensus algorithms allow a collection of machines to work as a coherent group that can survive the failures of some of its members. Although Paxos can solve consensus, it is indigestible for most people. Raft enhance understandability and also provides a better foundation for building practical system.</p>
<p>This paper called <a class="link" href="https://raft.github.io/raft.pdf"  target="_blank" rel="noopener"
    >In Search of an Understandable Consensus Algorithm(Extended Version)</a> was published in 2014 by Stanford University. This paper is very in-depth, I recommend reading it several times.</p>
<h2 id="replicated-state-machines">Replicated state machines
</h2><p>Consensus algorithms typically arise in the context of <em><strong>replicated state machines</strong></em>. Replicated state machines are typically implemented using a replicated log. The consensus algorithms manage a replicated log containing state machine commands from clients. The state machines process identical sequences of commands from the logs so that they produce the same outputs.</p>
<h2 id="the-raft-consensus-algorithm">The Raft consensus algorithm
</h2><p>Raft decomposes the consensus problem into three relatively independent subproblems:</p>
<ul>
<li>
<p><strong>Leader election: A new leader must be chosen when an existing leader fails</strong></p>
</li>
<li>
<p><strong>Log replication: The leader must accept log entries from clients and replicate them across the cluster, forcing the other logs to agree with their own.</strong></p>
</li>
<li>
<p><strong>Safety: If any server has applied a particular log entry to its state machine, then no other server may apply a different command for the same log index.</strong></p>
</li>
</ul>
<h3 id="raft-basics">Raft basics
</h3><p>At any time Raft cluster, each server is in one of three states: <em><strong>leader</strong></em>, <em><strong>follower</strong></em>, or <em><strong>candidate</strong></em>. In normal operation there is exactly one leader and all of the other servers are followers.</p>
<p><em><strong>Followers</strong></em> are passive: They issue no requests on their own but simply respond to requests from <em><strong>leaders</strong></em> and <em><strong>candidates</strong></em>. The <em><strong>leader</strong></em> handles all client requests. The <em><strong>candidate</strong></em> elects a new leader.</p>
<p>Raft divides time into <code>terms</code> of arbitrary length. Each term begins with an election, in which one or more candidates attempt to become <em><strong>leader</strong></em>. If a <em><strong>candidate</strong></em> wins the election, then it serves as a <em><strong>leader</strong></em> and other servers become <em><strong>followers</strong></em>.</p>
<p>Each server stores a <code>current term</code> number, which increases monotonically over time. Current terms are exchanged whenever servers communicate; if one server‚Äôs current term is smaller than the other‚Äôs, then it updates its current term to the larger value. If a candidate or leader discovers that its term is out of date, it immediately reverts to <em><strong>follower</strong></em> state. If a server receives a request with a stale term number, it rejects the request.</p>
<p>Raft servers communicate using remote procedure calls, and the basic consensus algorithm requires only two types of RPCs. <code>RequestVote RPCs</code> are initiated by <em><strong>candidates</strong></em> during elections, and <code>AppendEntries RPCs</code> are initiated by <em><strong>leaders</strong></em> to replicate log entries and to provide a form of heartbeat.</p>
<h3 id="leader-election">Leader election
</h3><p>A server remains in <em><strong>follower</strong></em> state as long as it receives valid RPCs from a <em><strong>leader</strong></em> or <em><strong>candidate</strong></em>. <em><strong>Leaders</strong></em> send periodic heartbeats to all <em><strong>followers</strong></em> to maintain their authority. If a <em><strong>follower</strong></em> receives no communication over a period called the <em>election timeout</em>, then it assumes there is no viable <em><strong>leader</strong></em> and begins an election to choose a new <em><strong>leader</strong></em>.</p>
<p>To begin an election, a <em><strong>follower</strong></em> increments its <code>current term</code> and transitions to <em><strong>candidate</strong></em> state. It then votes for itself and issues <code>RequestVote RPCs</code> in parallel to each of the other servers in the cluster. A <em><strong>candidate</strong></em> continues in this state until one of three things happens:</p>
<ul>
<li>
<p>(a) it wins the election</p>
</li>
<li>
<p>(b) another server establishes itself as a leader</p>
</li>
<li>
<p>(c) a period goes by with no winner.</p>
</li>
</ul>
<blockquote>
<p>Raft uses randomized election timeouts to ensure that split votes are rare and that they are resolved quickly. To prevent split votes in the first place, election timeouts are chosen randomly from a fixed interval (e.g., 150‚Äì300ms).</p></blockquote>
<h3 id="log-replication">Log replication
</h3><p>Each client request contains a command to be executed by the replicated state machines. The <em><strong>leader</strong></em> appends the command to its log as a new entry, then issues <code>AppendEntries RPCs</code> in parallel to each of the other servers to replicate the entry. When the entry has been safely replicated (as described below), the <em><strong>leader</strong></em> applies the entry to its state machine and returns the result of that execution to the client.</p>
<p>Each log entry stores a state machine command along with the term number when the entry was received by the <em><strong>leader</strong></em>. Each log entry also has an integer index identifying its position in the log.</p>
<p>Raft guarantees that committed entries are durable and will eventually be executed by all of the available state machines. A log entry is committed once the <em><strong>leader</strong></em> that created the entry has replicated it on a majority of the servers. This also commits all preceding entries in the <em><strong>leader</strong></em>‚Äôs log, including entries created by previous <em><strong>leaders</strong></em>. The <em><strong>leader</strong></em> keeps track of the highest index it knows to be committed, and it includes that index in future <code>AppendEntries RPCs</code> (including heartbeats) so that the other servers eventually find out. Once a <em><strong>follower</strong></em> learns that a log entry is committed, it applies the entry to its local state machine (in log order).</p>
<p>Raft maintains the following properties, which together constitute the Log Matching Property:</p>
<ul>
<li>
<p>If two entries in different logs have the same <code>index and term</code>, then they store the same command.</p>
</li>
<li>
<p>If two entries in different logs have the same <code>index and term</code>, then the logs are identical in all preceding entries.</p>
</li>
</ul>
<p>When sending an <code>AppendEntries RPC</code>, the <em><strong>leader</strong></em> includes the <code>index and term</code> of the entry in its log that immediately precedes the new entries. If the follower does not find an entry in its log with the same index and term, then it refuses the new entries.</p>
<p>To bring a <em><strong>follower</strong></em>‚Äôs log into consistency with its own, the leader must find the latest log entry where the two logs agree, delete any entries in the follower‚Äôs log after that point, and send the follower all of the leader‚Äôs entries after that point. All of these actions happen in response to the consistency check performed by <code>AppendEntries RPCs.</code> The leader maintains a <code>nextIndex</code> for each <em><strong>follower,</strong></em> which is the index of the next log entry the leader will send to that follower. When a <em><strong>leader</strong></em> first comes to power, it initializes all <code>nextIndex</code> values to the index just after the last one in its log. If a follower‚Äôs log is inconsistent with the leader‚Äôs, the AppendEntries consistency check will fail in the next <code>AppendEntries RPC</code>. After a rejection, the leader decrements <code>nextIndex</code> and retries the <code>AppendEntries RPC</code>.</p>
<h3 id="safety">Safety
</h3><p>The previous sections described how Raft elects leaders and replicates log entries. However, the mechanisms described so far are not quite sufficient to ensure that each state machine executes the same commands in the same order. For example, a <em><strong>follower</strong></em> might be unavailable while the <em><strong>leader</strong></em> commits several log entries, then it could be elected <em><strong>leader</strong></em> and overwrite these entries with new ones; as a result, different state machines might execute different command sequences.</p>
<h4 id="election-restriction">Election restriction
</h4><p>Raft uses the voting process to prevent a <em><strong>candidate</strong></em> from winning an election unless its log contains all committed entries. A candidate must contact a majority of the cluster to be elected, which means that every committed entry must be present in at least one of those servers. If the candidate‚Äôs log is at least as up-to-date as any other log in that majority (where ‚Äúup-to-date‚Äù is defined precisely below), then it will hold all the committed entries.</p>
<h4 id="commiting-entries-from-previous-terms">Commiting entries from previous terms
</h4><p>Once a log entry for the current term is accepted by the majority of machines(half), the <em><strong>Leader</strong></em> commits it. If the <em><strong>Leader</strong></em> dies while submitting the entry, the next Leader will continue to try to complete the copy of the entry. However, the <em><strong>Leader</strong></em> cannot immediately confirm that an entry from a previous term has been committed, even if it is already stored on most machines.</p>
<p>Therefore, Raft does not attempt to submit log entries from the previous term by checking the number of copies. Only the number of copies is checked to submit a log entry for the <code>current term</code>. When an entry for the current term is submitted, all entries currently in that entry are implicitly submitted.</p>
<h2 id="cluster-membership-changes">Cluster membership changes
</h2><p>For the configuration change mechanism to be safe, there must be no point during the transition where two leaders can be elected for the same term.</p>
<p>To ensure the security of node changes, Raft adopts a two-stage approach. First, the cluster switches to a joint consensus state, and after the joint consensus is committed, the system switches to the new configuration.</p>
<ul>
<li>
<p>Log entries are replicated to all servers in both configurations.</p>
</li>
<li>
<p>Any server from either configuration may serve as a leader.</p>
</li>
<li>
<p>The agreement requires separate majorities from <em>both</em> the old and new configurations.</p>
</li>
</ul>
<p>The cluster configuration uses special entry storage and transport in the log. The process is as follows:</p>
<ol>
<li>
<p>The Leader receives a request and switches the cluster configuration from <code>C_old</code> to <code>C_new</code></p>
</li>
<li>
<p>The Leader stores <code>C_old</code> and <code>C_new</code> as the joint consensus <code>C_old</code>, new configuration in a log entry</p>
</li>
<li>
<p>Append this log entry to all machines with the old and new configurations.</p>
</li>
<li>
<p>When a machine receives such a log entry and adds it to its logs (no submission is required), all subsequent operations are performed based on this configuration.</p>
</li>
<li>
<p>When <code>C_old</code>, new is accepted by most machines, the Leader commits it. In this case, any machine configured with <code>C_old</code> or <code>C_new</code> cannot be selected as the Leader.</p>
</li>
<li>
<p>The Leader creates a log entry for <code>C_new</code>, appends it to all machines, and submits it</p>
</li>
</ol>
<p>The following problems still exist when the cluster member changes:</p>
<ol>
<li>
<p>The new machine does not store any logs when it joins the cluster, and it takes a while to catch up with the old machine, which may reduce the availability of the cluster in a short period. When adding nodes to a cluster, Raft introduces a new phase in which new machines can normally receive additional requests, but are not considered voting nodes, and consensus can be reached without considering these new nodes. Perform the preceding operations when the logs of the new node catch up with the progress of the old node.</p>
</li>
<li>
<p>The Leader of the cluster may not be part of the new configuration. In this case, when the Leader submits <code>C_new</code>, it should itself be pulled down. This results in a period when the Leader manages a cluster that does not contain itself and replicates logs but does not consider itself a principal.</p>
</li>
<li>
<p>Those servers that are taken down may break the cluster, and since these machines cannot receive heartbeats, elections may be held. A canvassing request with a new term is then sent, causing the cluster Leader to revert to the Follower. Although the election will not succeed in this case, the new Leader will still be generated in the new cluster, but the removed machine will still time out the election, resulting in poor overall availability.</p>
</li>
</ol>
<blockquote>
<p>To prevent problem 3 from happening, Raft adds a restriction: If the server receives a vote request within the timeout period of receiving a heartbeat from the current Leader, it will not renew the term and vote. This allows a Leader not to be ousted by a larger term vote as long as he can maintain the heartbeat of the current cluster.</p></blockquote>
<h2 id="log-compaction">Log compaction
</h2><p>As logs grow, the machine cannot store all logs in memory, so snapshots need to be introduced to periodically keep the state of the system in persistent storage so that logs from the start to the snapshot point are safely removed from memory.</p>
<p>Each machine in the cluster independently manages its snapshot, which contains only the committed log entries in its log. In addition to saving the current state of the state machine, you also need to save some metadata:</p>
<ul>
<li>
<p>Log index of the last log entry included in the snapshot</p>
</li>
<li>
<p>Log term of the last log entry included in the snapshot</p>
</li>
</ul>
<p>This metadata is mainly used for continuity checks on append requests (where the previous log entries need to be compared). If you want to support the cluster node changes mentioned above, the snapshot must also contain the latest configuration information at the snapshot point. After the snapshot is written, all logs and historical snapshots before the snapshot point are deleted.</p>
<p>Occasionally, when the <em><strong>Leader</strong></em> needs to synchronize its logs to some newly added or backward nodes, it needs to send snapshots. The <em><strong>leader</strong></em> will send <code>installSnapshotRPC</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SnapshotRequest</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">term</span> <span class="c1">// leader term</span>
</span></span><span class="line"><span class="cl">    <span class="nx">leaderId</span> <span class="c1">// so follower can redirect clients</span>
</span></span><span class="line"><span class="cl">    <span class="nx">lastIncludedIndex</span> <span class="c1">// the snapshot replaces all entries up through and including this inedex</span>
</span></span><span class="line"><span class="cl">    <span class="nx">lastIncludedTerm</span> <span class="c1">// term of lastIncludeIndex</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nx">offset</span> <span class="c1">// byte offset where chunk is positioned in the snapshot file</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">[]</span> <span class="c1">// raw bytes of the snapshot chunk, staring at offset</span>
</span></span><span class="line"><span class="cl">    <span class="nx">done</span> <span class="c1">// true if this is the last chunk</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SnapshotReply</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">term</span> <span class="c1">// currentTerm, for leader to update itself</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>Reply immediately if <code>term &lt; currentTerm</code></p>
</li>
<li>
<p>Create new snapshot file if first chunk (offset is 0)</p>
</li>
<li>
<p>Write data into snapshot file at given offset</p>
</li>
<li>
<p>Reply and wait for more data chunks if done is false</p>
</li>
<li>
<p>Save snapshot file, discard any existing or partial snapshot with a smaller index</p>
</li>
<li>
<p>If existing log entry has same index and term as snapshot‚Äôs last included entry, retain log entries following it and reply</p>
</li>
<li>
<p>Discard the entire log</p>
</li>
<li>
<p>Reset state machine using snapshot contents (and load snapshot‚Äôs cluster configuration)</p>
</li>
</ol>
<h2 id="raft-implementation">Raft Implementation
</h2><p>server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Raftnode</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// persisten state on all servers</span>
</span></span><span class="line"><span class="cl">    <span class="nx">currentTerm</span> <span class="c1">// latest term server has seen (initialized to 0 on first boot, increases monotonically)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">votedFor</span> <span class="c1">// candidateId that received vote in current term (or null if none)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">log</span><span class="p">[]</span> <span class="c1">// log entries; each entry contains command for state machine, and term when entry was received by leader (first index is 1)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// volatile state on all servers</span>
</span></span><span class="line"><span class="cl">    <span class="nx">commitIndex</span> <span class="c1">// index of highest log entry known to be committed (initialized to 0, increases monotonically)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">lastApplied</span> <span class="c1">// index of highest log entry applied to state machine (initialized to 0, increases monotonically)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// volatile state on leaders</span>
</span></span><span class="line"><span class="cl">    <span class="nx">nextIndex</span><span class="p">[]</span> <span class="c1">// for each server, index of the next log entry to send to that server (initialized to leader last log index + 1)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">matchIndex</span><span class="p">[]</span> <span class="c1">// for each server, index of highest log entry known to be replicated on server (initialized to 0, increases monotonically)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>AppenEntries</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AppendEntriesRequest</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">term</span> <span class="c1">// leader‚Äôs term</span>
</span></span><span class="line"><span class="cl">    <span class="nx">leaderId</span> <span class="c1">// so follower can redirect clients</span>
</span></span><span class="line"><span class="cl">    <span class="nx">prevLogIndex</span> <span class="c1">//index of log entry immediately preceding new ones</span>
</span></span><span class="line"><span class="cl">    <span class="nx">prevLogTerm</span> <span class="c1">// term of prevLogIndex entry</span>
</span></span><span class="line"><span class="cl">    <span class="nx">entries</span><span class="p">[]</span> <span class="c1">// log entries to store (empty for heartbeat; may send more than one for efficiency)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">leaderCommit</span> <span class="c1">// leader‚Äôs commitIndex</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AppendEntriesReply</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">term</span> <span class="c1">// currentTerm, for leader to update itself</span>
</span></span><span class="line"><span class="cl">    <span class="nx">success</span> <span class="c1">// true if follower contained entry matching prevLogIndex and prevLogTerm</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>Reply false if <code>term &lt; currentTerm</code></p>
</li>
<li>
<p>Reply false if log doesn‚Äôt contain an entry at <code>prevLogIndex</code> whose term matches <code>prevLogTerm</code></p>
</li>
<li>
<p>If an existing entry conflicts with a new one (same index but different terms), delete the existing entry and all that follow it</p>
</li>
<li>
<p>Append any new entries not already in the log</p>
</li>
<li>
<p>If <code>leaderCommit &gt; commitIndex</code>, set <code>commitIndex = min(leaderCommit, index of last new entry)</code></p>
</li>
</ol>
<p>RequsetVote</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">RequestVoteRequest</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">term</span> <span class="c1">// candidate‚Äôs term</span>
</span></span><span class="line"><span class="cl">    <span class="nx">candidateId</span> <span class="c1">// candidate requesting vote</span>
</span></span><span class="line"><span class="cl">    <span class="nx">lastLogIndex</span> <span class="c1">// index of candidate‚Äôs last log entry (¬ß5.4)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">lastLogTerm</span> <span class="c1">// term of candidate‚Äôs last log entry (¬ß5.4)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">RequsetVoteReply</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">term</span> <span class="c1">// currentTerm, for candidate to update itself</span>
</span></span><span class="line"><span class="cl">    <span class="nx">voteGranted</span> <span class="c1">// true means candidate received vote</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>Reply false if <code>term &lt; currentTerm</code></p>
</li>
<li>
<p>If votedFor is null or <code>candidateId,</code> and <em><strong>candidate</strong></em>‚Äôs log is at least as up-to-date as receiver‚Äôs log, grant vote</p>
</li>
</ol>
<p><strong>Rules for Servers</strong></p>
<p>All Servers:</p>
<ul>
<li>
<p>If <code>commitIndex</code> &gt; <code>lastApplied</code>: increment <code>lastApplied</code>, apply <code>log[lastApplied]</code> to state machine</p>
</li>
<li>
<p>If RPC request or response contains <code>term T</code> &gt; <code>currentTerm</code>: set <code>currentTerm = T</code>, convert to <code>follower</code></p>
</li>
</ul>
<p>Followers:</p>
<ul>
<li>
<p>Respond to RPCs from candidates and leaders</p>
</li>
<li>
<p>If <code>election timeout</code> elapses without receiving <code>AppendEntries RPC</code> from current leader or granting the vote to the candidate: convert to <code>candidate</code></p>
</li>
</ul>
<p>Candidates:</p>
<ul>
<li>
<p>On conversion to candidate, start election:</p>
<p>Increment <code>currentTerm</code></p>
<p>Vote for <code>self</code></p>
<p>Reset election <code>timer</code></p>
<p>Send <code>RequestVote RPCs</code> to all other servers</p>
</li>
<li>
<p>If votes received from majority of servers: become <code>leader</code></p>
</li>
<li>
<p>If AppendEntries RPC received from new leader: convert to <code>follower</code></p>
</li>
<li>
<p>If election <code>timeout</code> elapses: start new election</p>
</li>
</ul>
<p>Leaders:</p>
<ul>
<li>
<p>Upon election: send initial empty AppendEntries RPCs (heartbeat) to each server; repeat during idle periods to prevent election timeouts</p>
</li>
<li>
<p>If command received from client: append entry to local log, respond after entry applied to state machine</p>
</li>
<li>
<p>If <code>last log index</code> ‚â• <code>nextIndex</code> for a <code>follower</code>: send AppendEntries RPC with log entries starting at <code>nextIndex</code></p>
</li>
<li>
<p>If successful: update <code>nextIndex</code> and <code>matchIndex</code> for <code>follower</code></p>
</li>
<li>
<p>If AppendEntries fails because of log inconsistency: decrement <code>nextIndex</code> and retry</p>
</li>
<li>
<p>If there exists an N such that <code>N &gt; commitIndex</code>, a majority of <code>matchIndex[i] ‚â• N</code>, and <code>log[N].term == currentTerm</code>: set <code>commitIndex = N</code>.</p>
</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/mit-6.824/">MIT-6.824</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili","https://npm.elemecdn.com/@waline/emojis@1.1.0/bmoji","https://npm.elemecdn.com/@waline/emojis@1.1.0/weibo"],"lang":"zh-CN","locale":{"admin":"Admin","placeholder":"Ê¨¢ËøéÁïô‰∏ãÂÆùË¥µÁöÑËØÑËÆ∫!"},"pageview":true,"requiredMeta":["name","email","url"],"serverURL":"https://waline-drab-three.vercel.app/"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2025 GreyWind
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.cf4a995d396158b81f16c3d1a4c0e65d7051a35d12534c905d216887ca4b8b76.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
